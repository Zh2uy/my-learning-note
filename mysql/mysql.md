### 一条 SQL 语句在 MySQL 中是如何执行的

1. 连接数据库 （连接器）
   + 客户端连接连接器，连接器对连接请求作连接管理、权限校验，权限校验通过，进入下一步
2. 查询缓存
   + 如果打开了mysql的此时如果缓存中存在查询结果，则直接返回缓存中的查询结果，没有缓存或者没有开启缓存，则进入下一步 
3. 分析SQL语句 （分析器）
   + 词法分析:
     + 识别分割 sql 文本类容，例如 关键词、列名、表明等
   + 语法分析：
     + 判断语法是否正确，不正确，返回相应错误
     + 将分割后的 字符串 生成 解析树
   + 预处理器
     + 进一步检查 解析树 是否合法，例如 表名是否存在，列名否存在，还会校验用户是否有表的操作权限，预处理后，得到新的解析树
4. 优化 sql 语句 （优化器）
   + 对查询进行优化，根据解析树生成不同的执行计划，选择最优的执行计划
     + 有多个索引的时候，决定使用那个索引
     + 多表关联的时候，决定各个基准表和表的连接顺序
5. 执行sql语句（执行器）
   + 判单执行权限，判单用户是否具有表执行查询的权限，没有则返回无权限错误
   + 调用存储引擎接口查询
     + 条件有主键
       - 调用 innoDb 引擎接口，从主键索引中检索 主键 对应的记录
       - 主键索引等值查询只会查询出一条记录，将该记录返回客户端
       - 至此，语句执行完成
     + 无主键（全表扫描）
       + 调用 innoDb 引擎接口获取表的第一行，判断条件是否符合，不是则跳过，是则缓存到结果集中
       + 调用 引擎接口 获取 ‘下一条’，重复相同的逻辑判断，直至表尾
       + 执行器将上述遍历过程中所有满足条件的行组成结果集返回给客户端
       + 至此，语句执行完成
        

### 事务是什么
+ 事务指的是逻辑上的一组操作，组成这组操作的各个单元要么全部成功，要么全部失败
+ 事务具有四大特性
    + 原子性
        + 事务最小单元，要么全部成功，要么全部失败
    + 一致性
      + 事务前后数据的完整性必须保持一致
    + 隔离性
      + 多个用户并发使用数据库时，彼此事务操作数据不能互相干扰，所以要隔离
    + 持久性
      + 事务一旦提交，它对数据的改变就是永久性的
+ 事务会产生的并发问题
    + 脏读
      + 一个事务读到了另一个事务未提交的数据
    + 不可重复读
      + 一个事务读到另一个事务已经 update 的数据。引发事务中的多次查询结果不一致
    + 虚读/幻读
      + 一个事务读到另一个事务已经 insert 的数据。导致事务中多次查询结果的不一致
+ 事务的隔离级别
  + 读未提交
    + 一个事务都到另一个事务没有提交的数据，存在脏读、不可重复读、幻读的问题
  + 读已提交
    + 一个事务读到另一个事务已经提交的事务，存在不可重复读、幻读的问题
  + 可重复读
    + 在一个事务中读到的数据始终保持一致，无论另一个事务是否提交，存在幻读问题
  + 串行化读
    + 同时只能执行一个事务，相当于事务中的单线程，所以不存在事务多线程的问题
+ 事务的安全性、性能与隔离级别的关系
  + 隔离级别越高，性能越差
  + 安全性越高，隔离级别越高
        